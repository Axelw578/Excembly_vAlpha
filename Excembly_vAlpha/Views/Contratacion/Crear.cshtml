@model Excembly_vAlpha.ViewModels.ContratacionViewModel

@{
    ViewData["Title"] = "Crear Contratación";
}

<div class="container mt-4">
    <h2>Crear Contratación</h2>

    <form method="post" asp-action="Crear">
        <!-- Campo oculto para ID de contratación -->
        <input type="hidden" id="ContratacionId" name="ContratacionId" value="@Model.ContratacionId" />

        <!-- Información del Usuario -->
        <input type="hidden" asp-for="UsuarioId" />
        <div class="mb-3">
            <label for="NombreUsuario" class="form-label">Nombre del Usuario</label>
            <input type="text" id="NombreUsuario" name="NombreUsuario" value="@Model.NombreUsuario" class="form-control" readonly />
        </div>

        <div class="mb-3">
            <label for="CorreoUsuario" class="form-label">Correo del Usuario</label>
            <input type="email" id="CorreoUsuario" name="CorreoUsuario" value="@Model.CorreoUsuario" class="form-control" readonly />
        </div>

        <!-- Selección del Plan -->
        <!-- Selección del Plan -->
        <div class="mb-3">
            <label for="PlanId" class="form-label">Seleccionar Plan</label>
            <select id="PlanId" name="PlanId" class="form-select">
                <option value="">Seleccione un plan</option>
                @foreach (var plan in Model.PlanesDisponibles)
                {
                    <option value="@plan.PlanId">@plan.Nombre - @plan.Precio.ToString("C")</option>
                }
            </select>
        </div>

        <!-- Servicios Adicionales (solo si se selecciona un Plan) -->
        <div class="mb-3" id="serviciosAdicionalesSection" style="display: @(Model.PlanId.HasValue ? "block" : "none")">
            <label class="form-label">Servicios Adicionales</label>
            <div id="serviciosAdicionales">
                @foreach (var servicioAdicional in Model.ServiciosAdicionalesDisponibles)
                {
                    <div class="form-check">
                        <input type="checkbox" id="ServicioAdicional_@servicioAdicional.ServicioId"
                               name="ServiciosAdicionalesSeleccionados"
                               value="@servicioAdicional.ServicioId"
                               class="form-check-input"
                               @(Model.ServiciosAdicionalesSeleccionados.Contains(servicioAdicional.ServicioId) ? "checked" : "") />
                        <label for="ServicioAdicional_@servicioAdicional.ServicioId" class="form-check-label">
                            @servicioAdicional.NombreServicio
                        </label>
                        <span class="badge bg-secondary ms-2">@servicioAdicional.PrecioConDescuento.ToString("C")</span>
                    </div>
                }
            </div>
        </div>

        <!-- Selección de Servicios Independientes -->
        <div class="mb-3">
            <label for="ServicioId" class="form-label">Seleccionar Servicio Independiente</label>
            <select id="ServicioId" name="ServicioId" class="form-select">
                <option value="">Seleccione un servicio</option>
                @foreach (var servicio in Model.ServiciosDisponibles)
                {
                    <option value="@servicio.ServicioId">@servicio.Nombre - @servicio.Precio.ToString("C")</option>
                }
            </select>
        </div>

        <!-- Selección de Tipo de Servicio -->
        <div class="mb-3">
            <label for="TipoServicio" class="form-label">Tipo de Servicio</label>
            <select id="TipoServicio" name="TipoServicio" class="form-select">
                <option value="Sucursal">Sucursal</option>
                <option value="Domicilio">Domicilio</option>
            </select>
        </div>

        <!-- Botón de Envío -->
        <button type="submit" class="btn btn-primary">Guardar Contratación</button>
    </form>
</div>

@section Scripts {
    <script>
        // Mostrar/ocultar los servicios adicionales según el plan seleccionado
        document.getElementById("PlanId").addEventListener("change", function () {
            var planId = this.value;
            var serviciosAdicionalesSection = document.getElementById("serviciosAdicionalesSection");

            // Si se selecciona un plan, mostrar los servicios adicionales
            if (planId) {
                serviciosAdicionalesSection.style.display = "block";
            } else {
                serviciosAdicionalesSection.style.display = "none";
            }
        });

        // Inicializar el estado de la sección de servicios adicionales al cargar la página
        document.addEventListener("DOMContentLoaded", function () {
            var planId = document.getElementById("PlanId").value;
            var serviciosAdicionalesSection = document.getElementById("serviciosAdicionalesSection");
            if (planId) {
                serviciosAdicionalesSection.style.display = "block";
            } else {
                serviciosAdicionalesSection.style.display = "none";
            }
        });
    </script>
}
